#!/bin/bash
#SBATCH --job-name=vpc-str
#SBATCH --output=slurm_%x_%A-%a.log       # standard output / error log (%x = job name, %A = job id, %a = array index)
##SBATCH --error=slurm_%x_%A-%a.err        # standard error log (%x = job name, %A = job id, %a = array index)
#SBATCH --ntasks=1                        # run a single task

#SBATCH --mail-user=akazachkov@ufl.edu
#SBATCH --mail-type=BEGIN,FAIL,END        # mail events (NONE, BEGIN, END, FAIL, ALL)

#SBATCH --account=akazachkov
#SBATCH --qos=akazachkov

#SBATCH --time=01:20:00                   # time limit hrs:min:sec
#SBATCH --mem=4G                        # job memory
##SBATCH --array=16,29,44,109,214,217,218,421,431
##SBATCH --array=1-15,17-28,30-43,45-108,110-213,215-216,219-420,422-430,432-435

#SBATCH --array=1-2982
##SBATCH --array=1                         # test
#SBATCH --array=15,35,37,48,49,50,51,52,78,145,174,192,193,201,218,244,374,411,430,437,441,461,463,470,472,473,474,475,477,478,484,485,486,489,491,504,513,522,523,531,535,539,551,552,554,571,572,574,577,579,589,592,593,596,597,600,601,612,614,615,617,618,619,623,627,632,635,638,644,645,650,664,665,668,670,673,674,678,680,681,684,692,693,694,697,703,706,709,712,713,715,717,729,738,741,749,762,785,787,796,797,800,804,805,819,822,824,825,837,848,855,856,861,863,867,874,887,889,896,898,900,901,902,904,911,912,915,930,939,947,948,949,957,961,965,977,978,979,980,989,997,1005,1015,1018,1022,1023,1026,1038,1040,1041,1043,1044,1045,1046,1049,1053,1064,1070,1071,1081,1082,1089,1090,1094,1096,1100,1104,1107,1109,1110,1118,1119,1123,1129,1131,1132,1135,1136,1139,1141,1143,1164,1167,1175,1188,1207,1211,1213,1222,1223,1226,1230,1231,1244,1248,1250,1274,1287,1289,1293,1300,1313,1315,1316,1319,1322,1324,1326,1327,1328,1329,1330,1334,1337,1338,1341,1343,1356,1360,1365,1367,1375,1383,1387,1403,1404,1405,1406,1415,1423,1429,1441,1444,1448,1452,1461,1464,1466,1467,1469,1470,1471,1472,1475,1478,1479,1484,1487,1490,1496,1497,1507,1508,1515,1522,1526,1530,1532,1533,1535,1536,1544,1549,1555,1557,1558,1561,1562,1565,1567,1569,1582,1590,1593,1614,1630,1633,1637,1649,1652,1656,1657,1674,1676,1677,1689,1700,1708,1709,1713,1715,1719,1726,1739,1741,1742,1745,1748,1750,1751,1752,1753,1754,1755,1756,1766,1767,1769,1772,1782,1786,1791,1793,1801,1802,1809,1813,1814,1829,1830,1831,1832,1841,1849,1855,1867,1871,1878,1890,1892,1893,1895,1896,1897,1898,1901,1905,1910,1913,1916,1922,1923,1926,1928,1933,1934,1944,1947,1948,1956,1958,1959,1961,1962,1970,1971,1973,1983,1984,1986,1988,1990,1995,1996,2003,2016,2019,2021,2056,2059,2063,2075,2078,2082,2083,2102,2103,2115,2116,2125,2126,2133,2134,2135,2139,2141,2145,2152,2165,2167,2168,2171,2174,2176,2177,2178,2179,2180,2181,2182,2192,2193,2198,2203,2208,2212,2219,2226,2227,2228,2239,2255,2256,2257,2258,2259,2267,2275,2281,2296,2297,2304,2316,2318,2320,2321,2322,2323,2324,2325,2331,2336,2339,2342,2348,2349,2359,2360,2365,2370,2374,2376,2377,2378,2382,2385,2388,2389,2391,2395,2396,2397,2399,2401,2404,2409,2412,2416,2417,2418,2421,2422,2429,2432,2433,2434,2438,2442,2444,2445,2454,2482,2485,2486,2489,2491,2493,2498,2501,2504,2509,2514,2523,2525,2528,2529,2542,2547,2551,2552,2571,2591,2593,2608,2634,2701,2757,2774,2930

#########################
## To run this script, call (for example)
##     sbatch array_batch.sh [job list file]
## See arguments below
echo "=== START SLURM SCRIPT MESSAGES ==="
pwd; hostname; date


#########################
## Constants
export PROJ_DIR="${REPOS_DIR}/strengthening"
echo "Set PROJ_DIR=$PROJ_DIR"
export DEFAULT_CMD_FILE_DIR=${PROJ_DIR}/scripts
echo "Set DEFAULT_CMD_FILE_DIR=$CMD_FILE_DIR"


#########################
## Arguments
# Argument 1: CMD_FILE Set command file if given
if [ ! -z $1 ]
then
  CMD_FILE=$1
else
  CMD_FILE=${DEFAULT_CMD_FILE_DIR}/job_list_strengthen.txt
fi


#########################
## Prepare run command
echo ""
echo "Starting ${SLURM_ARRAY_JOB_ID}_${SLURM_ARRAY_TASK_ID}"
CMD=$(sed -n "${SLURM_ARRAY_TASK_ID}p" ${CMD_FILE})

echo ""
echo -e "Calling:\n$CMD"
echo "=== START RUNNING JOB ==="
echo ""


#########################
## RUN COMMAND HERE
eval $CMD


#########################
## Wrap up
echo "=== END JOB ==="
date
#echo "=== END SLURM SCRIPT MESSAGES ==="
